<?xml version="1.0" encoding="utf-8"?>
<!--
This file is part of "Playful Sparkle - IndexNow" project and subject to the terms
and conditions defined in file "LICENSE", which is part of this source
code package and also available on the project page: https://github.com/playfulsparkle/oc3_indexnow.git
-->
<modification>
    <name>Playful Sparkle - IndexNow</name>
    <code>ps_indexnow</code>
    <version>1.0.0</version>
    <author>Playful Sparkle</author>
    <link>https://github.com/playfulsparkle/oc3_indexnow.git</link>
    <!-- Category start -->
<file path="admin/controller/catalog/category.php">
        <operation>
            <search position="replace"><![CDATA[$this->model_catalog_category->addCategory($this->request->post);]]></search>
            <add><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $ps_category_id = $this->model_catalog_category->addCategory($this->request->post);

                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $category_store = (array) $this->request->post['category_store'];
                $post_data = $this->request->post;

                unset($post_data['category_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('category', 'index.php?route=product/category&path=' . (int) $ps_category_id, $category_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/category.php">
        <operation>
            <search><![CDATA[$this->model_catalog_category->editCategory]]></search>
            <add position="after"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $category_store = (array) $this->request->post['category_store'];
                $post_data = $this->request->post;

                unset($post_data['category_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('category', 'index.php?route=product/category&path=' . (int) $this->request->get['category_id'], $category_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/category.php">
        <operation>
            <search><![CDATA[$this->model_catalog_category->deleteCategory]]></search>
            <add position="before"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();
                $category_store = array_merge(
                    $this->request->server['HTTPS'] ? array(0 => HTTPS_CATALOG) : array(0 => HTTP_CATALOG),
                    $this->model_setting_store->getStores()
                );

                $post_data = $this->request->post;

                unset($post_data['category_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                foreach ((array) $this->request->post['selected'] as $category_id) {
                    $this->ps_indexnow->addToQueueItemData('category', 'index.php?route=product/category&path=' . (int) $category_id, $category_store, $content_hash, $languages);
                }
            }]]></add>
        </operation>
    </file>
    <!-- Category end -->

    <!-- Product start -->
    <file path="admin/controller/catalog/product.php">
        <operation>
            <search position="replace"><![CDATA[$this->model_catalog_product->addProduct($this->request->post);]]></search>
            <add><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $ps_product_id = $this->model_catalog_product->addProduct($this->request->post);

                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $product_store = (array) $this->request->post['product_store'];
                $post_data = $this->request->post;

                unset($post_data['product_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('product', 'index.php?route=product/product&product_id=' . (int) $ps_product_id, $product_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/product.php">
        <operation>
            <search><![CDATA[$this->model_catalog_product->editProduct]]></search>
            <add position="after"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $product_store = (array) $this->request->post['product_store'];
                $post_data = $this->request->post;

                unset($post_data['product_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('product', 'index.php?route=product/product&product_id=' . (int) $this->request->get['product_id'], $product_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/product.php">
        <operation>
            <search><![CDATA[$this->model_catalog_product->deleteProduct]]></search>
            <add position="before"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();
                $product_store = array_merge(
                    $this->request->server['HTTPS'] ? array(0 => HTTPS_CATALOG) : array(0 => HTTP_CATALOG),
                    $this->model_setting_store->getStores()
                );

                $post_data = $this->request->post;

                unset($post_data['product_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                foreach ((array) $this->request->post['selected'] as $product_id) {
                    $this->ps_indexnow->addToQueueItemData('product', 'index.php?route=product/product&product_id=' . (int) $product_id, $product_store, $content_hash, $languages);
                }
            }]]></add>
        </operation>
    </file>
    <!-- Product end -->

    <!-- Manufacturer start -->
    <file path="admin/controller/catalog/manufacturer.php">
        <operation>
            <search position="replace"><![CDATA[$this->model_catalog_manufacturer->addManufacturer($this->request->post);]]></search>
            <add><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $ps_manufacturer_id = $this->model_catalog_manufacturer->addManufacturer($this->request->post);

                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $manufacturer_store = (array) $this->request->post['manufacturer_store'];
                $post_data = $this->request->post;

                unset($post_data['manufacturer_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('manufacturer', 'index.php?route=product/manufacturer/info&manufacturer_id=' . (int) $ps_manufacturer_id, $manufacturer_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[$this->model_catalog_manufacturer->editManufacturer]]></search>
            <add position="after"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $manufacturer_store = (array) $this->request->post['manufacturer_store'];
                $post_data = $this->request->post;

                unset($post_data['manufacturer_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('manufacturer', 'index.php?route=product/manufacturer/info&manufacturer_id=' . (int) $this->request->get['manufacturer_id'], $manufacturer_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[$this->model_catalog_manufacturer->deleteManufacturer]]></search>
            <add position="before"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();
                $manufacturer_store = array_merge(
                    $this->request->server['HTTPS'] ? array(0 => HTTPS_CATALOG) : array(0 => HTTP_CATALOG),
                    $this->model_setting_store->getStores()
                );

                $post_data = $this->request->post;

                unset($post_data['manufacturer_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                foreach ((array) $this->request->post['selected'] as $manufacturer_id) {
                    $this->ps_indexnow->addToQueueItemData('manufacturer', 'index.php?route=product/manufacturer/info&manufacturer_id=' . (int) $manufacturer_id, $manufacturer_store, $content_hash, $languages);
                }
            }]]></add>
        </operation>
    </file>
    <!-- Manufacturer end -->

    <!-- Information start -->
    <file path="admin/controller/catalog/information.php">
        <operation>
            <search position="replace"><![CDATA[$this->model_catalog_information->addInformation($this->request->post);]]></search>
            <add><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $ps_information_id = $this->model_catalog_information->addInformation($this->request->post);

                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $information_store = (array) $this->request->post['information_store'];
                $post_data = $this->request->post;

                unset($post_data['information_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('information', 'index.php?route=information/information&information_id=' . (int) $ps_information_id, $information_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/information.php">
        <operation>
            <search><![CDATA[$this->model_catalog_information->editInformation]]></search>
            <add position="after"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();

                $information_store = (array) $this->request->post['information_store'];
                $post_data = $this->request->post;

                unset($post_data['information_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('information', 'index.php?route=information/information&information_id=' . (int) $this->request->get['information_id'], $information_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/information.php">
        <operation>
            <search><![CDATA[$this->model_catalog_information->deleteInformation]]></search>
            <add position="before"><![CDATA[if ($this->config->get('feed_ps_indexnow_status')) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');
                $this->load->model('setting/setting');

                $languages = $this->model_localisation_language->getLanguages();
                $information_store = array_merge(
                    $this->request->server['HTTPS'] ? array(0 => HTTPS_CATALOG) : array(0 => HTTP_CATALOG),
                    $this->model_setting_store->getStores()
                );

                $post_data = $this->request->post;

                unset($post_data['information_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                foreach ((array) $this->request->post['selected'] as $information_id) {
                    $this->ps_indexnow->addToQueueItemData('information', 'index.php?route=information/information&information_id=' . (int) $information_id, $information_store, $content_hash, $languages);
                }
            }]]></add>
        </operation>
    </file>
    <!-- Information end -->
</modification>
