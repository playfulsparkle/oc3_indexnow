<?xml version="1.0" encoding="utf-8"?>
<!--
This file is part of "Playful Sparkle - IndexNow" project and subject to the terms
and conditions defined in file "LICENSE", which is part of this source
code package and also available on the project page: https://github.com/playfulsparkle/oc3_indexnow.git
-->
<modification>
    <name>Playful Sparkle - IndexNow</name>
    <code>ps_indexnow</code>
    <version>1.0.0</version>
    <author>Playful Sparkle</author>
    <link>https://github.com/playfulsparkle/oc3_indexnow.git</link>
    <file path="admin/controller/catalog/category.php">
        <operation>
            <search position="replace"><![CDATA[$this->model_catalog_category->addCategory($this->request->post);]]></search>
            <add><![CDATA[if (
                    $this->config->get('feed_ps_indexnow_status') &&
                    in_array('category', (array) $this->config->get('feed_ps_indexnow_content_category'))
            ) {
                $ps_category_id = $this->model_catalog_category->addCategory($this->request->post);

                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');

                $languages = $this->model_localisation_language->getLanguages();

                $category_store = (array) $this->request->post['category_store'];
                $post_data = $this->request->post;

                unset($post_data['category_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('index.php?route=product/category&path=' . (int) $ps_category_id, $category_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/category.php">
        <operation>
            <search><![CDATA[$this->model_catalog_category->editCategory]]></search>
            <add position="before"><![CDATA[if (
                    $this->config->get('feed_ps_indexnow_status') &&
                    in_array('category', (array) $this->config->get('feed_ps_indexnow_content_category'))
            ) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');

                $languages = $this->model_localisation_language->getLanguages();

                $category_store = (array) $this->request->post['category_store'];
                $post_data = $this->request->post;

                unset($post_data['category_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                $this->ps_indexnow->addToQueueItemData('index.php?route=product/category&path=' . (int) $this->request->get['category_id'], $category_store, $content_hash, $languages);
            }]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/category.php">
        <operation>
            <search><![CDATA[$this->model_catalog_category->deleteCategory]]></search>
            <add position="before"><![CDATA[if (
                    $this->config->get('feed_ps_indexnow_status') &&
                    in_array('category', (array) $this->config->get('feed_ps_indexnow_content_category'))
            ) {
                $this->load->model('extension/feed/ps_indexnow');
                $this->load->model('localisation/language');
                $this->load->model('setting/store');

                $languages = $this->model_localisation_language->getLanguages();
                $category_store = $this->model_setting_store->getStores();

                $post_data = $this->request->post;

                unset($post_data['category_store']);

                $content_hash = md5(json_encode($post_data));

                $this->load->library('playfulsparkle/ps_indexnow');

                foreach ((array) $this->request->post['selected'] as $category_id) {
                    $this->ps_indexnow->addToQueueItemData('index.php?route=product/category&path=' . (int) $category_id, $category_store, $content_hash, $languages);
                }
            }]]></add>
        </operation>
    </file>
</modification>
